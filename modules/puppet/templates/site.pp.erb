<%
  hn = scope.lookupvar( "::hostname" )
  fhn = scope.lookupvar( "::fqdn" )
-%>
# This file is controlled by puppet. Do NOT edit! #
# Define filebucket 'main':
filebucket { 'main':
  server => '<%= fhn %>',
  path   => false,
}

# Make filebucket 'main' the default backup location for all File resources:
File { backup => 'main' }

node default {
  # This is where you can declare classes for all nodes.
  # Example:
  #   class { 'my_class': }
}

$hiera_gpg_check = hiera( 'mysql::server::root_passwd', 'N/A' )
if $hiera_gpg_check == 'N/A' {
    fail ( '     You need to configure GPG first. Please follow the instructions here: https://github.com/berndmweber/open-source-puppet-master#gpg-password-usage     ' )
}

node /<%= fhn %>/ {
  class { 'apache' : }
  class { 'ruby' : }
  class { 'passenger' : }
  class { 'puppet::master::dashboard' : }
  mysql::server::config { 'basic_config' :
    settings => {
      'mysqld' => {
        'default_storage_engine'  => 'InnoDB',
        'max_allowed_packet'      => '32M',
        'innodb_buffer_pool_size' => '512M',
        'innodb_file_per_table'   => '1',
        'innodb_data_file_path'   => 'ibdata:10M:autoextend:max:10G',
      }
    }
  }
}
